{% extends "base_commerce.html" %}
{% load static %}

{% block title %}{% if essaim %}Modifier{% else %}Nouvel{% endif %} essaim{% endblock %}

{% block content %}
<div class="elevage-content">
    <div class="elevage-card">
        <h2>{% if essaim %}Modifier l'essaim{% else %}Nouvel essaim{% endif %}</h2>
        
        {% if error_message %}
        <div class="alert-card high" style="margin-bottom: 1.5rem;">
            <div class="alert-icon high">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="alert-content">
                <div class="alert-title">Erreur</div>
                <div class="alert-message">{{ error_message }}</div>
            </div>
        </div>
        {% endif %}
        
        <form class="form-container" method="post">
            {% csrf_token %}
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" for="description">Description</label>
                    <input type="text" class="form-input" id="description" name="description" 
                           value="{{ essaim.description|default:'' }}" placeholder="Description de l'essaim">
                    <small class="form-help">Description optionnelle de l'essaim</small>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" for="origin">Origine *</label>
                    <select class="form-input" id="origin" name="origin" required>
                        <option value="">Sélectionnez une origine</option>
                        {% for origine in origins %}
                            <option value="{{ origine.id }}" 
                                {% if essaim and essaim.essaim_origin.id == origine.id %}selected{% endif %}>
                                {{ origine.name }}
                            </option>
                        {% endfor %}
                    </select>
                    <small class="form-help">Origine de l'essaim</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="race">Race *</label>
                    <select class="form-input" id="race" name="race" required>
                        <option value="">Sélectionnez une race</option>
                        {% for race in races %}
                            <option value="{{ race.id }}" 
                                {% if essaim and essaim.essaim_race.id == race.id %}selected{% endif %}>
                                {{ race.name }}
                            </option>
                        {% endfor %}
                    </select>
                    <small class="form-help">Race de l'essaim</small>
                </div>
            </div>
            
            <!-- Population initiale (pour nouveaux essaims seulement) -->
            {% if not essaim %}
            <div class="form-section">
                <h4>Population initiale</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="initial_ouvrier">Ouvrières</label>
                        <input type="number" class="form-input" id="initial_ouvrier" name="initial_ouvrier" 
                               value="{{ form_data.initial_ouvrier|default:0 }}" min="0">
                        <small class="form-help">Nombre d'ouvrières</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="initial_faux_bourdon">Faux-bourdons</label>
                        <input type="number" class="form-input" id="initial_faux_bourdon" name="initial_faux_bourdon" 
                               value="{{ form_data.initial_faux_bourdon|default:0 }}" min="0">
                        <small class="form-help">Nombre de faux-bourdons</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="initial_reine">Reines</label>
                        <input type="number" class="form-input" id="initial_reine" name="initial_reine" 
                               value="{{ form_data.initial_reine|default:1 }}" min="0">
                        <small class="form-help">Nombre de reines</small>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <div class="form-group">
                <label class="form-label" for="notes">Notes</label>
                <textarea class="form-input" id="notes" name="notes" rows="4" 
                          placeholder="Notes sur l'essaim...">{% if essaim %}{{ essaim.notes }}{% else %}{{ form_data.notes|default:'' }}{% endif %}</textarea>
                <small class="form-help">Observations et notes sur l'essaim</small>
            </div>
            
            <div class="form-row">
                <div class="btn-group" style="margin-left: auto;">
                    <a href="{% url 'essaims_list' %}" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Annuler
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> 
                        {% if essaim %}Modifier{% else %}Créer{% endif %}
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<style>
.form-section {
    margin: 2rem 0;
    padding: 1.5rem;
    background: rgba(255, 209, 0, 0.05);
    border-radius: var(--radius-md);
    border: 1px solid rgba(255, 209, 0, 0.2);
}

.form-section h4 {
    color: var(--honey-primary);
    margin-bottom: 1rem;
    font-weight: 600;
}

:root:not(.light-mode) .form-section {
    background: rgba(255, 209, 0, 0.1);
}
</style>
{% endblock %}
